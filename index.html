<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CC Score — Your Claude Code AI Productivity Grade</title>
<meta name="description" content="Get your Claude Code AI productivity grade (S/A/B/C/D/F). Select your ~/.claude folder and see your score instantly. No install, no data sent anywhere.">
<meta property="og:title" content="CC Score — What's your Claude Code grade?">
<meta property="og:description" content="A single 0–100 score that tells you how effectively you're using Claude Code. Free, local, zero-dependency.">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#0d1117;color:#e6edf3;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:24px 16px}
  .header{text-align:center;margin-bottom:32px}
  .header h1{font-size:1.6rem;font-weight:700;color:#e6edf3;margin-bottom:6px}
  .header p{color:#8b949e;font-size:0.9rem}
  .pick-box{background:#161b22;border:1px solid #30363d;border-radius:12px;padding:28px;text-align:center;max-width:520px;width:100%;margin-bottom:20px}
  .pick-label{color:#8b949e;font-size:0.85rem;margin-bottom:16px}
  .btn-pick{display:inline-block;background:#21262d;border:1px solid #388bfd;color:#79c0ff;padding:12px 24px;border-radius:8px;font-size:0.95rem;cursor:pointer;transition:background 0.2s;font-weight:500}
  .btn-pick:hover{background:#2d333b}
  .status{margin-top:14px;font-size:0.82rem;color:#8b949e;min-height:20px}
  .status.ok{color:#3fb950}
  .status.err{color:#f85149}
  /* Score card */
  .score-card{background:#161b22;border:1px solid #30363d;border-radius:14px;padding:32px;max-width:520px;width:100%;display:none}
  .score-card.visible{display:block}
  .grade-row{display:flex;align-items:center;gap:20px;margin-bottom:24px}
  .grade-circle{width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2.2rem;font-weight:900;flex-shrink:0;border:3px solid currentColor}
  .grade-S{color:#a371f7;background:rgba(163,113,247,0.12)}
  .grade-A{color:#3fb950;background:rgba(63,185,80,0.12)}
  .grade-B{color:#79c0ff;background:rgba(121,192,255,0.12)}
  .grade-C{color:#e3b341;background:rgba(227,179,65,0.12)}
  .grade-D{color:#f0883e;background:rgba(240,136,62,0.12)}
  .grade-F{color:#f85149;background:rgba(248,81,73,0.12)}
  .score-number{font-size:2.8rem;font-weight:900;line-height:1}
  .score-label{font-size:1rem;font-weight:600;margin-top:4px}
  .score-desc{font-size:0.82rem;color:#8b949e;margin-top:2px}
  /* breakdown bars */
  .breakdown{margin-bottom:20px}
  .breakdown-row{display:flex;align-items:center;gap:10px;margin-bottom:10px;font-size:0.82rem}
  .breakdown-name{width:100px;color:#8b949e;flex-shrink:0}
  .bar-track{flex:1;background:#21262d;border-radius:4px;height:8px;overflow:hidden}
  .bar-fill{height:100%;border-radius:4px;background:#79c0ff;transition:width 0.6s ease}
  .breakdown-pts{width:40px;text-align:right;color:#e6edf3;font-weight:600;flex-shrink:0;font-size:0.8rem}
  .breakdown-detail{color:#8b949e;font-size:0.75rem;margin-top:1px;padding-left:110px}
  /* share */
  .share-section{border-top:1px solid #21262d;padding-top:20px;margin-top:4px}
  .btn-share{background:#238636;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:0.88rem;font-weight:600;margin-right:8px;transition:background 0.2s}
  .btn-share:hover{background:#2ea043}
  .btn-copy{background:#21262d;border:1px solid #30363d;color:#e6edf3;padding:10px 16px;border-radius:8px;cursor:pointer;font-size:0.88rem;transition:background 0.2s}
  .btn-copy:hover{background:#2d333b}
  .tweet-text{font-size:0.78rem;color:#8b949e;margin-top:10px;padding:10px;background:#0d1117;border-radius:6px;font-family:monospace;white-space:pre-wrap;display:none}
  .try-another{margin-top:16px}
  .btn-again{background:none;border:1px solid #30363d;color:#8b949e;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:0.8rem}
  .btn-again:hover{color:#e6edf3;border-color:#58a6ff}
  /* footer */
  footer{margin-top:32px;color:#484f58;font-size:0.78rem;text-align:center}
  footer a{color:#58a6ff;text-decoration:none}
  .lang-toggle{position:fixed;top:12px;right:12px;background:#161b22;border:1px solid #30363d;color:#8b949e;padding:5px 10px;border-radius:6px;cursor:pointer;font-size:0.75rem}
</style>
</head>
<body>
<button class="lang-toggle" onclick="toggleLang()" id="lang-btn">日本語</button>
<div class="header">
  <h1 id="h-title">CC Score</h1>
  <p id="h-sub">Your Claude Code AI Productivity Grade</p>
</div>
<div class="pick-box" id="pick-box">
  <p class="pick-label" id="pick-label">Select your <code>~/.claude</code> folder to get your score</p>
  <label class="btn-pick" id="pick-btn">
    Browse My Claude Folder
    <input type="file" id="dir-input" webkitdirectory style="display:none" onchange="processDir(this.files)">
  </label>
  <div class="status" id="status"></div>
</div>
<div class="score-card" id="score-card">
  <div class="grade-row">
    <div class="grade-circle" id="grade-circle">?</div>
    <div>
      <div class="score-number" id="score-number">--</div>
      <div class="score-label" id="score-label">...</div>
      <div class="score-desc" id="score-desc"></div>
    </div>
  </div>
  <div class="breakdown" id="breakdown"></div>
  <div class="share-section">
    <button class="btn-share" id="btn-share" onclick="showTweet()">Share Score</button>
    <button class="btn-copy" id="btn-copy" onclick="copyTweet()">Copy</button>
    <div class="tweet-text" id="tweet-text"></div>
    <div class="try-another">
      <button class="btn-again" onclick="reset()" id="btn-again">Try another folder</button>
    </div>
  </div>
</div>
<footer>
  <p><a href="https://yurukusa.github.io/cc-toolkit/">cc-toolkit</a> — 30 free tools for Claude Code · <a href="https://github.com/yurukusa/cc-score">GitHub</a></p>
</footer>

<script>
// ── i18n ─────────────────────────────────────────────────────────────────────
let lang = 'en';
const T = {
  en: {
    title: 'CC Score',
    sub: 'Your Claude Code AI Productivity Grade',
    pickLabel: 'Select your <code>~/.claude</code> folder to get your score',
    pickBtn: 'Browse My Claude Folder',
    reading: 'Reading sessions…',
    noData: '⚠ No session data found — make sure you selected the .claude folder',
    loaded: n => `✓ ${n} sessions loaded — computing score…`,
    shareBtn: 'Share Score',
    copyBtn: 'Copy',
    again: 'Try another folder',
    breakdown: { Consistency:'Consistency', Autonomy:'Autonomy', 'Ghost Days':'Ghost Days', Volume:'Volume', Streak:'Streak' },
    gradeLabel: { S:'Cyborg', A:'Power User', B:'Growing', C:'Early Stage', D:'Getting Started', F:'Dormant' },
    gradeDesc: {
      S: 'You and AI are seamlessly fused.',
      A: 'Serious AI collaboration.',
      B: 'Your AI habits are taking shape.',
      C: 'Room to develop the relationship.',
      D: 'Keep going.',
      F: 'Wake up your AI.',
    },
  },
  ja: {
    title: 'CC Score',
    sub: 'Claude Code AIプロダクティビティグレード',
    pickLabel: '<code>~/.claude</code> フォルダを選択してスコアを計算',
    pickBtn: '.claudeフォルダを開く',
    reading: 'セッションを読み込み中…',
    noData: '⚠ セッションデータが見つかりません。.claudeフォルダを選択してください',
    loaded: n => `✓ ${n}セッション読み込み完了 — スコア計算中…`,
    shareBtn: 'スコアをシェア',
    copyBtn: 'コピー',
    again: '別のフォルダを試す',
    breakdown: { Consistency:'継続性', Autonomy:'自律性', 'Ghost Days':'ゴーストデイ', Volume:'使用量', Streak:'連続日数' },
    gradeLabel: { S:'サイボーグ', A:'パワーユーザー', B:'成長中', C:'初期段階', D:'スタートアップ', F:'休眠中' },
    gradeDesc: {
      S: 'AIとシームレスに融合している。',
      A: '本格的なAI協業ができている。',
      B: 'AI習慣が形成されつつある。',
      C: '関係を深める余地がある。',
      D: '続けよう。',
      F: 'AIを起こせ。',
    },
  },
};
function t(key, ...args) {
  const v = T[lang][key];
  return typeof v === 'function' ? v(...args) : v;
}
function toggleLang() {
  lang = lang === 'en' ? 'ja' : 'en';
  document.getElementById('lang-btn').textContent = lang === 'en' ? '日本語' : 'English';
  applyLang();
}
function applyLang() {
  document.getElementById('h-title').textContent = t('title');
  document.getElementById('h-sub').textContent = t('sub');
  document.getElementById('pick-label').innerHTML = t('pickLabel');
  const pickBtn = document.getElementById('pick-btn');
  pickBtn.childNodes[0].nodeValue = t('pickBtn') + ' ';
  document.getElementById('btn-share').textContent = t('shareBtn');
  document.getElementById('btn-copy').textContent = t('copyBtn');
  document.getElementById('btn-again').textContent = t('again');
}

// ── File reading helpers (adapted from cc-wrapped) ────────────────────────────
function _parseTs(line) {
  if (!line) return null;
  try {
    const obj = JSON.parse(line);
    const ts = obj.timestamp;
    if (!ts) return null;
    const d = new Date(ts);
    return isNaN(d) ? null : d.getTime();
  } catch { return null; }
}

async function _readFirstLast(file) {
  const firstChunk = await file.slice(0, 2048).text();
  const nl = firstChunk.indexOf('\n');
  const firstLine = nl >= 0 ? firstChunk.substring(0, nl) : firstChunk.trim();
  const readSize = Math.min(65536, file.size);
  const lastChunk = await file.slice(file.size - readSize).text();
  const lines = lastChunk.split('\n').filter(l => l.trim());
  const lastLine = lines[lines.length - 1] || firstLine;
  return { firstLine, lastLine };
}

// ── Date helpers ──────────────────────────────────────────────────────────────
function tsToDate(ts) {
  const d = new Date(ts);
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}
function addDays(dateStr, n) {
  const [y, m, d] = dateStr.split('-').map(Number);
  const dt = new Date(y, m-1, d); dt.setDate(dt.getDate()+n);
  return `${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,'0')}-${String(dt.getDate()).padStart(2,'0')}`;
}
function localToday() {
  const now = new Date();
  return new Date(now.getTime() - now.getTimezoneOffset()*60000).toISOString().slice(0,10);
}

// ── Score logic (ported from cli.mjs) ────────────────────────────────────────
function computeStreak(byDate, today) {
  let streak = 0, d = today;
  if (!byDate[d]) d = addDays(today, -1);
  while (byDate[d]) {
    const v = byDate[d];
    const active = (v.main||0)+(v.sub||0);
    if (active === 0) break;
    streak++; d = addDays(d, -1);
  }
  return streak;
}
function scoreConsistency(byDate, today, win=30) {
  let active=0;
  for (let i=0;i<win;i++) {
    const d=addDays(today,-i), v=byDate[d];
    if (v && ((v.main||0)+(v.sub||0))>0) active++;
  }
  const pct=active/win;
  return { points: Math.round(pct*30), activeDays: active, window: win, detail: `${active}/${win} days active` };
}
function scoreAutonomy(byDate, today, win=30) {
  let main=0, sub=0;
  for (let i=0;i<win;i++) {
    const d=addDays(today,-i), v=byDate[d];
    if (!v) continue;
    main += v.main||0; sub += v.sub||0;
  }
  const ratio = main>0 ? sub/main : (sub>0 ? 2 : 0);
  const points = Math.min(25, Math.round(ratio*12.5));
  return { points, ratio, mainH: main, subH: sub, detail: `${ratio.toFixed(2)}x ratio (${sub.toFixed(1)}h AI / ${main.toFixed(1)}h you)` };
}
function scoreGhost(byDate, today, win=30) {
  let ghost=0, active=0;
  for (let i=0;i<win;i++) {
    const d=addDays(today,-i), v=byDate[d];
    if (!v) continue;
    const m=v.main||0, s=v.sub||0;
    if (m>0||s>0) { active++; if (m===0&&s>0) ghost++; }
  }
  const pct = active>0 ? ghost/active : 0;
  const points = Math.min(20, Math.round(pct*25));
  return { points, ghostDays: ghost, activeDays: active, pct, detail: `${ghost} days AI ran solo (${Math.round(pct*100)}%)` };
}
function scoreVolume(byDate, today, win=30) {
  let total=0;
  for (let i=0;i<win;i++) {
    const d=addDays(today,-i), v=byDate[d];
    if (v) total+=(v.main||0)+(v.sub||0);
  }
  const points = Math.min(15, Math.round((total/100)*15));
  return { points, totalHours: total, detail: `${total.toFixed(1)}h total (last 30 days)` };
}
function scoreStreak(streak) {
  const points = Math.min(10, Math.round((streak/30)*10));
  return { points, streak, detail: `${streak} days current streak` };
}
function gradeInfo(score) {
  if (score>=90) return 'S';
  if (score>=75) return 'A';
  if (score>=60) return 'B';
  if (score>=45) return 'C';
  if (score>=30) return 'D';
  return 'F';
}

// ── Main processing ───────────────────────────────────────────────────────────
let _result = null;

async function processDir(fileList) {
  const statusEl = document.getElementById('status');
  statusEl.textContent = t('reading');
  statusEl.className = 'status';

  // Build byDate: {date: {main: hours, sub: hours}}
  const byDate = {};
  let sessionCount = 0;

  for (const file of Array.from(fileList)) {
    const path = file.webkitRelativePath;
    // Must match: projects/<dir>[/subagents]/<uuid>.jsonl
    const mainMatch = path.match(/projects\/([^/]+)\/[^/]+\.jsonl$/);
    const subMatch  = path.match(/projects\/([^/]+)\/subagents\/[^/]+\.jsonl$/);
    if ((!mainMatch && !subMatch) || file.size < 50) continue;
    const isMain = !!mainMatch && !subMatch;

    try {
      const { firstLine, lastLine } = await _readFirstLast(file);
      const startTs = _parseTs(firstLine);
      const endTs   = _parseTs(lastLine);
      if (!startTs || !endTs) continue;
      const ms = endTs - startTs;
      if (ms < 0 || ms > 7 * 864e5) continue;
      const hours = ms / 36e5;
      const date = tsToDate(startTs);
      if (!byDate[date]) byDate[date] = { main: 0, sub: 0 };
      if (isMain) byDate[date].main += hours;
      else        byDate[date].sub  += hours;
      sessionCount++;
    } catch {}
  }

  if (sessionCount === 0) {
    statusEl.textContent = t('noData');
    statusEl.className = 'status err';
    return;
  }
  statusEl.textContent = t('loaded', sessionCount);
  statusEl.className = 'status ok';

  const today = localToday();
  const streak = computeStreak(byDate, today);
  const cScore = scoreConsistency(byDate, today);
  const aScore = scoreAutonomy(byDate, today);
  const gScore = scoreGhost(byDate, today);
  const vScore = scoreVolume(byDate, today);
  const sScore = scoreStreak(streak);
  const total = cScore.points + aScore.points + gScore.points + vScore.points + sScore.points;
  const grade = gradeInfo(total);

  _result = { total, grade, cScore, aScore, gScore, vScore, sScore, byDate };
  renderScore(_result);
}

function renderScore(r) {
  const { total, grade, cScore, aScore, gScore, vScore, sScore } = r;
  const gradeLabel = T[lang].gradeLabel[grade];
  const gradeDesc  = T[lang].gradeDesc[grade];

  // grade circle
  const circle = document.getElementById('grade-circle');
  circle.textContent = grade;
  circle.className = `grade-circle grade-${grade}`;

  // score
  document.getElementById('score-number').textContent = total + ' / 100';
  document.getElementById('score-label').textContent  = T[lang].gradeLabel[grade];
  document.getElementById('score-desc').textContent   = T[lang].gradeDesc[grade];

  // breakdown
  const rows = [
    ['Consistency', cScore.points, 30, cScore.detail],
    ['Autonomy',    aScore.points, 25, aScore.detail],
    ['Ghost Days',  gScore.points, 20, gScore.detail],
    ['Volume',      vScore.points, 15, vScore.detail],
    ['Streak',      sScore.points, 10, sScore.detail],
  ];
  const bdEl = document.getElementById('breakdown');
  bdEl.innerHTML = rows.map(([name, pts, max, detail]) => `
    <div class="breakdown-row">
      <div class="breakdown-name">${T[lang].breakdown[name] || name}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${Math.round(pts/max*100)}%"></div></div>
      <div class="breakdown-pts">${pts}/${max}</div>
    </div>
    <div class="breakdown-detail">${detail}</div>
  `).join('');

  // tweet text
  const tweetEl = document.getElementById('tweet-text');
  tweetEl.textContent = `My Claude Code AI Score: ${total}/100 (${grade} — ${T.en.gradeLabel[grade]})
→ ${cScore.activeDays} active days, ${aScore.ratio.toFixed(2)}x autonomy ratio, ${sScore.streak}-day streak
npx cc-score #ClaudeCode #AIProductivity`;

  document.getElementById('pick-box').style.display = 'none';
  document.getElementById('score-card').classList.add('visible');
}

function showTweet() {
  const el = document.getElementById('tweet-text');
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
}
function copyTweet() {
  const el = document.getElementById('tweet-text');
  el.style.display = 'block';
  navigator.clipboard.writeText(el.textContent).then(() => {
    const btn = document.getElementById('btn-copy');
    btn.textContent = '✓ Copied';
    setTimeout(() => { btn.textContent = t('copyBtn'); }, 2000);
  });
}
function reset() {
  _result = null;
  document.getElementById('score-card').classList.remove('visible');
  document.getElementById('pick-box').style.display = 'block';
  document.getElementById('tweet-text').style.display = 'none';
  document.getElementById('status').textContent = '';
  document.getElementById('dir-input').value = '';
}
</script>
</body>
</html>
